@model Dppkad.Models.ChartSkpdUpdate
@{
    ViewBag.Title = "Grafik Info";

    var localeDateFormat = System.Threading.Thread.CurrentThread.CurrentCulture.DateTimeFormat.ShortDatePattern;
}

<a title="" class="btn btn-white" href="@Url.Action("Index", "Admin")" data-original-title=" "><i class=" fa fa-chevron-left"></i> Admin Dashboard</a>
<br><br>

<div class="alert alert-success" role="alert" style="display: none;">
    <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
    <b>Success!</b> @ViewBag.Success
</div>
@if (@ViewBag.Success != null)
{
    <div class="alert alert-success" role="alert" style="display: block;">
        <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <b>Success!</b> @ViewBag.Success
    </div>
}

<br />

@using (Html.BeginForm("GraphInfo", "Admin", FormMethod.Post))
{
    <section class="panel">
        <header class="panel-heading font-bold">Grafik Data</header>
        <div class="panel-body">
            <div class="row" style="margin-bottom: 15px;">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Tahun Anggaran</label></div>
                        <div class="col-lg-6">
                            @{
                                var selectItems = new List<SelectListItem>();
                                for (int i = 0; i < 6; i++)
                                {
                                    selectItems.Add(new SelectListItem()
                                    {
                                        Text = Convert.ToString(DateTime.Now.Year + (i - 1)),
                                        Value = Convert.ToString(DateTime.Now.Year + (i - 1)),
                                    });
                                }                          
                            }
                            @Html.DropDownListFor(o => o.TahunBudget
                                  , selectItems
                                  , new { @class = "form-control placeholder mandatory" })
                            @Html.ValidationMessageFor(o => o.TahunBudget)
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Realisasi</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.Realisasi, null, new { @class = "form-control text-right mandatory numeric", @placeholder = "0" })
                            @Html.ValidationMessageFor(o => o.Realisasi)
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-bottom: 15px;">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Anggaran</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.Budget, null, new { @class = "form-control text-right mandatory numeric", @placeholder = "0" })
                            @Html.ValidationMessageFor(o => o.Budget)
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="panel">
        <footer class="panel-footer bg-light lter">
            <input type="submit" id="statusButton_" value="Submit" class="btn btn-primary" style="width: 100px;" />
        </footer>
    </section>
}

@Html.Partial("_Grafik")

@section Scripts{
    <script src="@Url.Content("~/Scripts/plugins/datatables/jquery.dataTables.min.js")"></script>

    <script type="text/javascript">
        var oTableGrafik;

        $(document).ready(function () {
            $('#table-grafik-list').each(function () {
                oTableGrafik = $(this).dataTable({
                    "bServerSide": true,
                    "bProcessing": true,
                    "aaSorting": [[0, "asc"]],
                    "sScrollXInner": "200%",
                    "sAjaxSource": "@Url.Action("AjaxGraphHandler", "Admin")",
                    "sDom": "<'row'<'col-sm-6'><'col-sm-6'>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
                    "sPaginationType": "full_numbers",
                    "bAutoWidth": false,
                    "aoColumns": [
                        { "mData": "TahunBudget" },
                        { "mData": "Budget" },
                        { "mData": "Realisasi" }
                    ],
                    "aoColumnDefs": [
                        { "sWidth": "50%", "aTargets": [1, 2] },
                        { "sClass": "center", "aTargets": [0, 1, 2] }
                    ],
                    "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                        $('td:eq(0)', nRow).css("text-align", "center");
                        $('td:eq(1)', nRow).css("text-align", "right");
                        $('td:eq(2)', nRow).css("text-align", "right");
                        return nRow;
                    },
                    "fnServerData": function (sSource, aoData, fnCallback) {
                        $.ajax({
                            "dataType": 'json',
                            "type": "POST",
                            "url": sSource,
                            "data": aoData,
                            "success": fnCallback,
                            "timeout": 10000, // optional if you want to handle timeouts (which you should)
                            "error": handleAjaxError // this sets up jQuery to give me errors
                        });
                    }
                });
            });
        });

        //handling Error
        function handleAjaxError(textStatus) {
            if (textStatus === 'timeout') {
                bootstrap_alert.error("Timeout", "The server took too long to send the data.");
            } else {
                bootstrap_alert.error("Connection problem", "An error occurred on the server. Please try again in a few minute or contact your administrator.");
            }
        }

        bootstrap_alert = function () { };
        bootstrap_alert.success = function (header, message) {
            $('#alert_placeholder').html('<div class="alert alert-success" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><b>' + header + '!</b> ' + message + '</div>');
        };

        bootstrap_alert.error = function (header, message) {
            $('#alert_placeholder').html('<div class="alert alert-danger" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><b>' + header + '!</b> ' + message + '</div>');
        };
    </script>
}